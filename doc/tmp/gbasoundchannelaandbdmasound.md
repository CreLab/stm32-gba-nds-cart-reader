# GBA Sound Channel A and B - DMA Sound


The GBA contains two DMA sound channels (A and B), each allowing to replay digital sound (signed 8bit data, ie. -128..+127). Data can be transferred from INTERNAL memory (not sure if EXTERNAL memory works also ?) to FIFO by using DMA channel 1 or 2, the sample rate is generated by using one of the Timers.

### 40000A0h - FIFO_A_L - Sound A FIFO, Data 0 and Data 1 (W)
### 40000A2h - FIFO_A_H - Sound A FIFO, Data 2 and Data 3 (W)
These two registers may receive 32bit (4 bytes) of audio data (Data 0-3, Data 0 being located in least significant byte which is replayed first).
Internally, the capacity of the FIFO is 8 x 32bit (32 bytes), allowing to buffer a small amount of samples. As the name says (First In First Out), oldest data is replayed first.

### 40000A4h - FIFO_B_L - Sound B FIFO, Data 0 and Data 1 (W)
### 40000A6h - FIFO_B_H - Sound B FIFO, Data 2 and Data 3 (W)
Same as above, for Sound B.

### Initializing DMA-Sound Playback
- Select Timer 0 or 1 in SOUNDCNT_H control register.
- Clear the FIFO.
- Manually write a sample byte to the FIFO.
- Initialize transfer mode for DMA 1 or 2.
- Initialize DMA Sound settings in sound control register.
- Start the timer.

### DMA-Sound Playback Procedure
The pseudo-procedure below is automatically repeated.

```
+-----------------------------------------------------------------------+
|       If Timer overflows then                                         |
|         Move 8bit data from FIFO to sound circuit.                    |
|         If FIFO contains only 4 x 32bits (16 bytes) then              |
|           Request more data per DMA                                   |
|           Receive 4 x 32bit (16 bytes) per DMA                        |
|         Endif                                                         |
|       Endif                                                           |
+-----------------------------------------------------------------------+
```

This playback mechanism will be repeated forever, regardless of the actual length of the sample buffer.

### Synchronizing Sample Buffers
The buffer-end may be determined by counting sound Timer IRQs (each sample byte), or sound DMA IRQs (each 16th sample byte). Both methods would require a lot of CPU time (IRQ processing), and both would fail if interrupts are disabled for a longer period.
Better solutions would be to synchronize the sample rate/buffer length with V-blanks, or to use a second timer (in count up/slave mode) which produces an IRQ after the desired number of samples.

### The Sample Rate
The GBA hardware does internally re-sample all sound output to 32.768kHz (default SOUNDBIAS setting). It\'d thus do not make much sense to use higher DMA/Timer rates. Best re-sampling accuracy can be gained by using DMA/Timer rates of 32.768kHz, 16.384kHz, or 8.192kHz (ie. fragments of the physical output rate).



